---
phase: 01-lightbox-viewer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - _includes/components/head.njk
  - _includes/layouts/base.njk
  - _includes/assets/js/lightbox-init.js
  - _includes/assets/css/lightbox.css
autonomous: true

must_haves:
  truths:
    - "lightGallery library is installed as a project dependency"
    - "lightGallery CSS is loaded on every page"
    - "lightGallery JS initialization runs on every page"
  artifacts:
    - path: "package.json"
      provides: "lightGallery dependency"
      contains: "lightgallery"
    - path: "_includes/assets/js/lightbox-init.js"
      provides: "lightGallery initialization with all required options"
      min_lines: 5
    - path: "_includes/assets/css/lightbox.css"
      provides: "lightGallery CSS inclusion and custom overrides"
      min_lines: 3
    - path: "_includes/components/head.njk"
      provides: "lightGallery CSS loaded in head"
      contains: "lightbox"
    - path: "_includes/layouts/base.njk"
      provides: "lightGallery JS loaded and initialized"
      contains: "lightbox-init"
  key_links:
    - from: "_includes/layouts/base.njk"
      to: "_includes/assets/js/lightbox-init.js"
      via: "Eleventy js bundle include"
      pattern: "lightbox-init"
    - from: "_includes/components/head.njk"
      to: "_includes/assets/css/lightbox.css"
      via: "Eleventy css bundle or style include"
      pattern: "lightbox"
---

<objective>
Install lightGallery and integrate its CSS and JS into the Eleventy build pipeline so it loads on every page.

Purpose: Foundation for lightbox functionality with smooth zoom-in animation from inline image to lightbox -- without the library loaded, no lightbox features work.
Output: lightGallery installed via npm, CSS in head, JS initialized in base layout.
</objective>

<execution_context>
@/Users/grahamharper/.claude/get-shit-done/workflows/execute-plan.md
@/Users/grahamharper/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-lightbox-viewer/01-RESEARCH.md
@eleventy.config.js
@_includes/layouts/base.njk
@_includes/components/head.njk
@_includes/assets/js/inline.js
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install lightGallery and create initialization script</name>
  <files>
    package.json
    _includes/assets/js/lightbox-init.js
  </files>
  <action>
    1. Run `npm install lightgallery --save` to add lightGallery as a dependency.

    2. Create `_includes/assets/js/lightbox-init.js` with lightGallery initialization:
       - Use `lightGallery(container, {...})` function (NOT ES module import -- this will be inlined via Eleventy bundle)
       - Container: document.querySelector('body') or a specific gallery container
       - Use dynamic mode with `dynamic: false` (we'll add data attributes to images instead)
       - Enable: speed: 500 (for smooth zoom animation)
       - Set plugins: lgZoom (for pinch-to-zoom)
       - Set download: false
       - Set counter: false (cleaner UI)
       - Set getCaptionFromTitleOrAlt: true (use alt text for captions)
       - Set mode: 'lg-fade' or 'lg-zoom-in-big' (for the nice zoom animation you want)

    Note: lightGallery will be loaded as a script tag from node_modules (copied to public), NOT as an ES module import. The initialization script assumes lightGallery is already available as a global. This is because the site uses Eleventy's bundle system which inlines JS and minifies with UglifyJS (which does not support ES module syntax).
  </action>
  <verify>
    - `cat package.json | grep lightgallery` shows lightgallery in dependencies
    - `cat _includes/assets/js/lightbox-init.js` shows lightGallery initialization with correct options
    - `ls node_modules/lightgallery/lightgallery.umd.js` confirms library files exist
  </verify>
  <done>lightGallery is installed as a dependency and initialization script exists with all required configuration options (zoom animation, keyboard, touch, captions).</done>
</task>

<task type="auto">
  <name>Task 2: Wire lightGallery CSS and JS into Eleventy build</name>
  <files>
    _includes/components/head.njk
    _includes/layouts/base.njk
    _includes/assets/css/lightbox.css
    eleventy.config.js
  </files>
  <action>
    1. Copy lightGallery's dist files to public directory for serving:
       - Add a passthrough copy in `eleventy.config.js` for lightGallery dist files:
         `"./node_modules/lightgallery/lightgallery.umd.js": "/js/lightgallery.umd.js"`
         `"./node_modules/lightgallery/css/lightgallery-bundle.min.css": "/css/lightgallery.min.css"`
         `"./node_modules/lightgallery/plugins/zoom/lg-zoom.umd.js": "/js/lg-zoom.umd.js"`
       Add these to the existing `.addPassthroughCopy({...})` call (the one on lines 21-26 of eleventy.config.js).

    2. Create `_includes/assets/css/lightbox.css` with:
       - A comment noting lightGallery CSS is loaded via link tag from passthrough copy
       - Any custom overrides for the lightbox caption styling:
         - `.lg-sub-html` padding and font styling to match site fonts (Domine for headings, Source Sans Pro for body)
         - Ensure caption text is readable (white text on semi-transparent dark background -- lightGallery defaults are usually fine, just verify)
       - Keep this file minimal -- lightGallery defaults are good. Only override if needed for site font consistency.

    3. Edit `_includes/components/head.njk`:
       - Add a `<link rel="stylesheet" href="/css/lightgallery.min.css">` BEFORE the font preconnect lines (line 25 area)

    4. Edit `_includes/layouts/base.njk`:
       - Add `<script src="/js/lightgallery.umd.js"></script>` BEFORE the existing `<script type="module" src="{% getBundleFileUrl "js" %}"></script>` line
       - Add `<script src="/js/lg-zoom.umd.js"></script>` after the lightgallery script (needed for pinch-to-zoom)
       - Add the lightbox initialization to the js bundle block. Inside the existing `{% js %}...{% endjs %}` block (after the inline.js include on line 23), add:
         `{% include "assets/js/lightbox-init.js" %}`

    5. If custom CSS overrides were added in step 2, include them in the head. Add inside the existing `<style>{% getBundle "css" %}</style>` block by adding a `{% css %}{% include "assets/css/lightbox.css" %}{% endcss %}` paired shortcode in base.njk or head.njk.

    Important: The site uses UglifyJS for JS minification. The lightbox-init.js must use ES5-compatible syntax (var instead of const/let, no arrow functions, no template literals). UglifyJS does NOT support ES6+.
  </action>
  <verify>
    - Run `npm run build` and confirm it completes without errors
    - Check `_site/js/lightgallery.umd.js` exists (passthrough copy worked)
    - Check `_site/css/lightgallery.min.css` exists (passthrough copy worked)
    - Check `_site/js/lg-zoom.umd.js` exists (zoom plugin passthrough worked)
    - Grep built HTML for lightgallery references: `grep -l "lightgallery" _site/**/*.html | head -5` should find pages
    - Run `npm start` and verify in browser that lightGallery CSS/JS loads (check Network tab, no 404s)
  </verify>
  <done>lightGallery CSS loads in head of every page, lightGallery JS and zoom plugin load and initialize on every page, build completes without errors, no 404s for lightGallery assets.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without errors
2. lightGallery JS and CSS files are present in `_site/` output
3. Every HTML page in `_site/` includes lightGallery CSS link and JS script tags
4. `npm start` shows no console errors related to lightGallery
5. Zoom plugin (lg-zoom.umd.js) is loaded for pinch-to-zoom support
</verification>

<success_criteria>
- lightGallery is installed and its CSS/JS/plugins are served on every page
- Initialization script runs with zoom-in animation effect
- Build pipeline is intact -- no regressions in existing functionality
- Ready for Plan 02 to add lightbox markup to images
</success_criteria>

<output>
After completion, create `.planning/phases/01-lightbox-viewer/01-01-SUMMARY.md`
</output>
